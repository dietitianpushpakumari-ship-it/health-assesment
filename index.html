<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalized Health Assessment | Nutricare Wellness</title>
    
    <!-- Open Graph Meta Tags for Facebook Preview -->
    <meta property="og:title" content="FREE 60-Second Vital Health Risk Assessment">
    <meta property="og:description" content="Stop guessing! Instantly calculate your personalized risk score based on key labs (Sugar, Cholesterol, TSH, etc.) and get an initial dietitian-designed solution.">
    
    <!-- FIX APPLIED: Changed to an absolute URL placeholder to pass scraper validation. 
    ***MANDATORY ACTION***: Once your site is LIVE, REPLACE the URL below 
    (starting with 'https://') with the full, absolute URL of your deployed image 
    (e.g., https://your-site.com/images/assessment_banner.png). 
    The scraper will only accept the full path. -->
    <meta property="og:image" content="https://dietitianpushpakumari-ship-it.github.io/health-assesment/images/book.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <meta property="og:url" content="https://dietitianpushpakumari-ship-it.github.io/health-assesment/">
    <meta property="og:type" content="website">

    <!-- REQUIRED FIX: Added fb:app_id for Meta validation. 
    ***MANDATORY ACTION***: REPLACE the content value below with your actual Facebook App ID. -->
    <!-- You can replace the whole line below with your actual ID, e.g., <meta property="fb:app_id" content="123456789012345678"> -->
    <meta property="fb:app_id" content="4095536934031083">
    <!-- END Open Graph Meta Tags -->
    
    <title>Advanced Personalized Health Risk Assessment</title>
    <!-- Load Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add MathJax CDN for LaTeX Rendering of TSH unit (mu IU/mL) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script type="text/x-mathjax-config">
        // Configure MathJax to process LaTeX inside dollar signs $...$
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
            'HTML-CSS': { linebreaks: { automatic: true } },
            SVG: { linebreaks: { automatic: true } }
        });
        
        function typesetResults() {
            const resultDiv = document.getElementById('risk-summary');
            if (resultDiv) {
                setTimeout(() => {
                    MathJax.Hub.Queue(["Typeset", MathJax.Hub, resultDiv]);
                }, 50); 
            }
        }
    </script>
    <script>
        // Configure Tailwind to use the Inter font for better readability
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-diet': '#10b981', // Emerald green for health
                        'primary-dark': '#047857',
                        'bg-light': '#f0fdfa',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdfa;
        }
        label span {
            color: #ef4444; /* Red color for required fields */
        }
        input:focus, select:focus, textarea:focus {
            --tw-ring-color: var(--tw-color-primary-dark);
            box-shadow: 0 0 0 2px var(--tw-color-primary-diet);
            border-color: var(--tw-color-primary-dark);
        }
        /* Custom styles for the visual risk indicator */
        .risk-bar-container {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        .risk-bar-fill {
            height: 100%;
            transition: width 0.5s ease-out;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-bg-light">

    <div id="calculator-app" class="max-w-xl mx-auto bg-white shadow-2xl rounded-xl overflow-hidden my-6 p-4 sm:p-6">
        
        <!-- HEADER (Updated with smaller font size) -->
        <header class="bg-primary-diet text-white py-4 px-6 md:py-5 md:px-8 shadow-lg -mx-4 -mt-4 sm:-mx-6 sm:-mt-6 rounded-t-xl">
            <div class="text-lg font-extrabold tracking-wider text-center mb-1">
                NUTRICARE <span class="font-light text-gray-100">WELLNESS</span>
            </div>
            <!-- Font size reduced here: text-3xl sm:text-4xl changed to text-2xl sm:text-3xl -->
            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-center">Health Risk Assessment</h1>
        </header>

        <!-- --- QUICK START CALL TO ACTION (Material Redesign) --- -->
        <!-- Note: Added a green gradient, strong shadow, icon, and click-to-focus functionality. -->
        <div id="quick-start-cta" class="p-6 my-6 rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-[1.01] cursor-pointer" 
             style="background: linear-gradient(135deg, #10b981 0%, #047857 100%);"
             onclick="document.getElementById('age').focus()">
            
            <div class="flex items-center justify-center space-x-4 text-white">
                <!-- Icon: Clock for 60 seconds / Speed -->
                <svg class="w-10 h-10 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="text-left">
                    <p class="text-2xl font-extrabold tracking-wide">
                        Start Your Free Assessment!
                    </p>
                    <p class="text-sm font-medium opacity-90 mt-1">
                        Takes less than a minute. Click here to begin.
                    </p>
                </div>
            </div>
        </div>

        <!-- Input Form Section -->
        <div id="input-form" class="space-y-6 pt-0">
            
            <h2 class="text-lg font-semibold text-gray-800 border-b pb-2">Your Vitals & Background</h2>
            
            <form id="hra-form" onsubmit="calculateRisk(event)">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-5">
                    
                    <!-- Age & Sex (MANDATORY) -->
                    <div>
                        <label for="age" class="block text-sm font-medium text-gray-700">Age (Years) <span>*</span></label>
                        <input type="number" id="age" min="18" max="120" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 35">
                    </div>
                    <div>
                        <label for="sex" class="block text-sm font-medium text-gray-700">Sex <span>*</span></label>
                        <select id="sex" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet">
                            <option value="">Select</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>

                    <!-- Height & Weight for BMI (MANDATORY) -->
                    <div>
                        <label for="height" class="block text-sm font-medium text-gray-700">Height (cm) <span>*</span></label>
                        <input type="number" id="height" min="100" max="250" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 175" oninput="updateLiveBMI()">
                    </div>
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700">Weight (kg) <span>*</span></label>
                        <input type="number" id="weight" min="30" max="300" step="0.1" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 78.5" oninput="updateLiveBMI()">
                    </div>

                    <!-- Live BMI Feedback -->
                    <div id="live-bmi-feedback" class="sm:col-span-2 text-center py-2 px-3 rounded-lg border border-gray-200 bg-gray-50 text-sm hidden">
                        <!-- Dynamic BMI content goes here -->
                    </div>

                    <!-- Waist & Hip for WHR (OPTIONAL) -->
                    <div class="sm:col-span-2 grid grid-cols-2 gap-4">
                        <label class="block text-sm font-medium text-gray-700 col-span-2">Body Measurements (cm) - Optional</label>
                        <input type="number" id="waist" min="50" class="block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="Waist (Circumference)">
                        <input type="number" id="hip" min="50" class="block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="Hip (Circumference)">
                    </div>


                    <!-- Blood Pressure (OPTIONAL) -->
                    <div class="sm:col-span-2 grid grid-cols-2 gap-4">
                        <label class="block text-sm font-medium text-gray-700 col-span-2">Blood Pressure (mmHg)</label>
                        <input type="number" id="sysBP" min="60" class="block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="Systolic (Top)">
                        <input type="number" id="diaBP" min="40" class="block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="Diastolic (Bottom)">
                    </div>

                    <!-- Metabolic Vitals (OPTIONAL) -->
                    <div>
                        <label for="sugar" class="block text-sm font-medium text-gray-700">Fasting Sugar (mg/dL)</label>
                        <input type="number" id="sugar" min="50" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 95">
                    </div>
                    
                    <div>
                        <label for="hba1c" class="block text-sm font-medium text-gray-700">HbA1c (%)</label>
                        <input type="number" id="hba1c" min="4.0" max="20.0" step="0.1" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 5.8">
                    </div>

                    <div>
                        <label for="cholesterol" class="block text-sm font-medium text-gray-700">Total Cholesterol (mg/dL)</label>
                        <input type="number" id="cholesterol" min="50" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 180">
                    </div>
                    <div>
                        <label for="tsh" class="block text-sm font-medium text-gray-700">TSH ($\mu$IU/mL)</label>
                        <input type="number" id="tsh" min="0.1" max="100" step="0.1" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 2.5">
                    </div>
                    
                    <!-- Kidney Profile (OPTIONAL) -->
                    <div>
                        <label for="creatinine" class="block text-sm font-medium text-gray-700">Creatinine (mg/dL)</label>
                        <input type="number" id="creatinine" min="0.1" step="0.01" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 0.8">
                    </div>
                    <div>
                        <label for="urea" class="block text-sm font-medium text-gray-700">Urea / BUN (mg/dL)</label>
                        <input type="number" id="urea" min="5" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 15">
                    </div>
                    
                    <!-- Liver Profile (OPTIONAL) -->
                    <div class="sm:col-span-2 grid grid-cols-2 gap-4">
                        <label class="block text-sm font-medium text-gray-700 col-span-2">Liver Enzymes (U/L)</label>
                        <input type="number" id="sgot" min="1" class="block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="SGOT/AST (e.g., 30)">
                        <input type="number" id="sgpt" min="1" class="block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="SGPT/ALT (e.g., 35)">
                    </div>

                    <!-- Hemoglobin (OPTIONAL) -->
                    <div>
                        <label for="hemoglobin" class="block text-sm font-medium text-gray-700">Hemoglobin (g/dL)</label>
                        <input type="number" id="hemoglobin" min="5" max="20" step="0.1" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet" placeholder="e.g., 14.2">
                    </div>
                    
                    <!-- Activity (MANDATORY) -->
                    <div>
                        <label for="activity" class="block text-sm font-medium text-gray-700">Physical Activity Level <span>*</span></label>
                        <select id="activity" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet">
                            <option value="4">High (Daily intense exercise)</option>
                            <option value="3">Moderate (3-5 times/week)</option>
                            <option value="2" selected>Light (1-2 times/week)</option>
                            <option value="1">Sedentary (No exercise)</option>
                        </select>
                    </div>

                    <!-- Sleep & Alcohol (NEW LIFESTYLE METRICS) -->
                    <div>
                        <label for="sleep" class="block text-sm font-medium text-gray-700">Average Sleep (Hours/Night) <span>*</span></label>
                        <select id="sleep" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet">
                            <option value="0">Select</option>
                            <option value="3">Less than 6 hours</option>
                            <option value="1">6 to 8 hours (Optimal)</option>
                            <option value="2">More than 8 hours</option>
                        </select>
                    </div>
                    <div>
                        <label for="alcohol" class="block text-sm font-medium text-gray-700">Alcohol Consumption <span>*</span></label>
                        <select id="alcohol" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet">
                            <option value="0">Select</option>
                            <option value="1">Never/Rarely</option>
                            <option value="2">Occasional (1-2 times/week, light)</option>
                            <option value="3">Moderate (3-5 times/week, standard)</option>
                            <option value="4">Heavy (Daily or binge)</option>
                        </select>
                    </div>

                    <!-- Smoking (MANDATORY) -->
                    <div>
                        <label for="smoking" class="block text-sm font-medium text-gray-700">Smoking Status <span>*</span></label>
                        <select id="smoking" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-2 border focus:ring-primary-diet focus:border-primary-diet">
                            <option value="0">Select</option>
                            <option value="1">Never Smoked</option>
                            <option value="2">Former Smoker (Quit > 1 year)</option>
                            <option value="3">Current Smoker</option>
                        </select>
                    </div>

                    <!-- Family History (OPTIONAL) -->
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-medium text-gray-700">Family History (Select all that apply)</label>
                        <div class="mt-2 space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" name="history" value="diabetes" class="rounded text-primary-diet focus:ring-primary-diet">
                                <span class="ml-2 text-sm text-gray-600">Diabetes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="history" value="heart" class="rounded text-primary-diet focus:ring-primary-diet">
                                <span class="ml-2 text-sm text-gray-600">Heart Disease (before age 60)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="history" value="bp" class="rounded text-primary-diet focus:ring-primary-diet">
                                <span class="ml-2 text-sm text-gray-600">High Blood Pressure</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="history" value="thyroid" class="rounded text-primary-diet focus:ring-primary-diet">
                                <span class="ml-2 text-sm text-gray-600">Thyroid Condition</span>
                            </label>
                        </div>
                    </div>
                </div>

                <p id="error-message" class="text-sm text-red-500 mt-4 hidden">Please fill in all fields marked with an asterisk (*).</p>
                <p id="calculation-error" class="text-sm text-red-500 mt-4 hidden">An unexpected calculation error occurred. Please check your inputs or try again.</p>


                <button type="submit" class="w-full mt-8 py-3 px-4 bg-primary-diet text-white font-semibold rounded-lg shadow-md hover:bg-primary-dark transition duration-200 focus:outline-none focus:ring-2 focus:ring-primary-diet focus:ring-offset-2">
                    Generate My Personalized Risk Assessment
                </button>
            </form>
        </div>

        <!-- Result Section (Initially HIDDEN) -->
        <div id="result-section" class="pt-6 space-y-6 hidden">
            <h2 class="text-2xl font-bold text-primary-dark">Your Health Risk Assessment Report</h2>
            
            <div id="risk-summary" class="p-4 rounded-xl shadow-lg bg-gray-50 border-l-4 border-primary-diet">
                <!-- Dynamic Content Here -->
            </div>

            <!-- New Actionable Focus Section -->
            <div id="actionable-focus" class="p-5 bg-yellow-50 border border-yellow-300 rounded-xl shadow-inner">
                <h3 class="text-lg font-bold text-yellow-800 flex items-center mb-2">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    Primary Health Focus
                </h3>
                <p id="primary-focus-text" class="text-gray-800 font-semibold text-base mb-3"></p>
                
                <h4 class="text-sm font-bold text-primary-dark uppercase border-t pt-2 mt-3">Quick-Start Micro-Action:</h4>
                <p id="micro-action-text" class="text-sm text-gray-700 italic"></p>
            </div>

            <!-- Dietitian Approach Section (Removed detailed info, kept high-level approach and CTA) -->
            <div id="dietitian-approach" class="space-y-4">
                <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 pt-4">Your Clinical Dietitian Solution</h3>
                
                <ul class="list-none text-gray-700 space-y-3 p-4 bg-primary-diet/10 rounded-xl border border-primary-diet/20">
                    <li><div class="flex items-start"><span class="text-primary-dark mr-3 text-lg font-extrabold">&check;</span><p class="font-bold text-gray-800">Approach Philosophy: <span class="font-normal">This is <strong class="text-red-600">NOT</strong> a restrictive diet. We focus on personalized, sustainable nutrition for <strong class="text-primary-dark">food freedom</strong>.</span></p></div></li>
                    <li><div class="flex items-start"><span class="text-primary-dark mr-3 text-lg font-extrabold">&check;</span><p><strong class="text-primary-diet">Personalized Plan:</strong> We translate your results into a flexible meal structure tailored to your body's specific needs.</p></div></li>
                    <li><div class="flex items-start"><span class="text-primary-dark mr-3 text-lg font-extrabold">&check;</span><p><strong class="text-primary-diet">Root Cause Focus:</strong> We use targeted nutrition to naturally support optimal balance in your blood pressure, sugar, and thyroid function.</p></div></li>
                </ul>

                <p class="text-lg font-medium text-gray-800 pt-4">Don't wait until a diagnosis—let's optimize your health now.</p>
            </div>
            
            <!-- Call to Action -->
            <div class="pt-4 border-t">
                <div class="mt-2 mb-4 text-center p-3 border border-dashed border-gray-300 rounded-lg bg-gray-50">
                    <p class="text-sm text-gray-700">Want more free health tips? Explore our full wellness library:</p>
                    <a id="website-link" href="#" target="_blank" class="text-primary-diet hover:underline font-semibold mt-1 block">
                        Visit Our Wellness Hub &rarr;
                    </a>
                </div>
                
                <p class="text-center text-gray-600 mb-4">Ready to take the next step towards lasting health?</p>
                <a id="contact-link" href="#" target="_blank" class="block w-full text-center py-4 px-4 bg-primary-dark text-white font-extrabold rounded-lg shadow-xl hover:bg-primary-diet transition duration-300 transform hover:scale-[1.02]">
                    BOOK YOUR FREE INITIAL CONSULTATION (VIA WHATSAPP)
                </a>
            </div>

            <button onclick="resetCalculator()" class="w-full mt-4 py-2 text-sm text-gray-600 hover:text-primary-diet transition duration-200">
                &larr; Recalculate
            </button>

        </div>
    </div>

    <script>
        // --- CONFIGURATION START ---
        const WHATSAPP_BASE_URL = "https://wa.me/7978755097?text=";
        const WEBSITE_HUB_URL = "https://nutricarerwellness.my.canva.site/nutricare-wellness";
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('website-link').href = WEBSITE_HUB_URL;
        });
        // --- CONFIGURATION END ---
        
        // --- HELPER FUNCTIONS ---

        function getInputValue(id) {
            const element = document.getElementById(id);
            const value = parseFloat(element.value);
            return (element.value === '' || isNaN(value)) ? null : value;
        }

        function calculateBMI(H, W) {
            if (!H || !W) return null;
            const heightM = H / 100;
            return W / (heightM * heightM);
        }

        function getBMICategory(bmi) {
            if (bmi < 18.5) return 'Underweight';
            if (bmi <= 24.9) return 'Normal Weight';
            if (bmi <= 29.9) return 'Overweight';
            return 'Obese';
        }

        // Live feedback for BMI (Feature B)
        function updateLiveBMI() {
            const H = getInputValue('height');
            const W = getInputValue('weight');
            const feedbackDiv = document.getElementById('live-bmi-feedback');
            
            if (H && W && H > 0 && W > 0) {
                const bmi = calculateBMI(H, W);
                const category = getBMICategory(bmi);
                
                let colorClass = 'text-green-700 font-semibold';
                if (category === 'Overweight') colorClass = 'text-amber-700 font-semibold';
                if (category === 'Obese' || category === 'Underweight') colorClass = 'text-red-700 font-semibold';

                feedbackDiv.innerHTML = `Your **BMI** is **${bmi.toFixed(1)}**, which is classified as <span class="${colorClass}">${category}</span>.`;
                feedbackDiv.classList.remove('hidden');
                
            } else {
                feedbackDiv.classList.add('hidden');
            }
        }
        
        // Formats result lines with value, category, and normal range (Feature C enhancement)
        function formatVitalLine(label, value, unit, category, normalRange) {
            if (category === 'Not Provided') {
                return `<li class="text-gray-500">${label}: Not Provided</li>`;
            }
            
            const isRisk = (category !== 'Normal' && category !== 'Optimal' && category !== 'Optimal Range');
            const colorClass = isRisk ? 'text-red-600 font-medium' : 'text-gray-700';

            let valueDisplay = 'N/A';
            if (value !== null) {
                if (label.includes('HbA1c')) valueDisplay = value.toFixed(1);
                else if (label.includes('TSH') || label.includes('Creatinine')) valueDisplay = value.toFixed(2);
                else if (label.includes('Hemoglobin')) valueDisplay = value.toFixed(1);
                else if (label.includes('WHR')) valueDisplay = value.toFixed(2);
                else valueDisplay = value.toString();
            }
            
            let unitDisplay = valueDisplay + ' ' + unit;
            if (label === 'TSH') {
                // Use the formatted valueDisplay inside the LaTeX block
                unitDisplay = `$${valueDisplay} \\mu \\text{IU/mL}$`;
            } else if (label.includes('Blood Pressure')) {
                 unitDisplay = value + ' mmHg';
            } else if (label.includes('WHR')) {
                 unitDisplay = valueDisplay; // WHR has no unit symbol
            }

            return `<li class="${colorClass}">${label}: ${unitDisplay} (${category}) <span class="text-xs text-gray-500 italic ml-2"> (Normal: ${normalRange})</span></li>`;
        }
        
        // Determines the Primary Health Focus and Micro-Action (Features A & B)
        function getActionableAdvice(riskAreas, bmiCategory, smoking, activity, sleep, alcohol, sex) {
            const sortedAreas = Object.entries(riskAreas)
                .sort(([, a], [, b]) => b - a);

            const primaryArea = sortedAreas[0][0];
            let primaryFocusText = '';
            let microActionText = '';
            
            // Default action: Check lifestyle
            let mostImpactfulLifestyle = 'Sedentary Lifestyle';
            if (sleep > 1) mostImpactfulLifestyle = 'Poor Sleep Hygiene';
            if (alcohol > 2) mostImpactfulLifestyle = 'Alcohol Intake';
            if (smoking === 3) mostImpactfulLifestyle = 'Smoking Status';

            if (primaryArea === 'metabolic' && riskAreas[primaryArea] > 0) {
                primaryFocusText = "Blood Sugar Control and Cardiovascular Health. Your metabolic markers (BP, Sugar, Cholesterol) suggest an immediate need to improve insulin sensitivity and vessel health.";
                microActionText = "Replace all sugary drinks (soda, sweetened tea/coffee, juice) with water for the next 48 hours to immediately reduce sugar spikes.";
            } else if (primaryArea === 'anthropometric' && riskAreas[primaryArea] > 0) {
                primaryFocusText = "Visceral Fat Reduction and Healthy Weight Management. Your BMI and Waist-to-Hip Ratio indicate excess fat stored around vital organs, which increases long-term disease risk.";
                microActionText = "Aim for two 10-minute brisk walks today, one after breakfast and one after dinner, to help stabilize blood sugar and start reducing visceral fat.";
            } else if (primaryArea === 'specific_labs' && riskAreas[primaryArea] > 0) {
                primaryFocusText = "Specific Organ Support (Kidney/Liver/Thyroid). Your specific lab markers require targeted nutritional support to bring the thyroid, liver, or kidneys back into optimal balance.";
                microActionText = "Increase water intake by 2 glasses today and ensure you eat a protein source (e.g., egg, handful of nuts) with every meal to support liver and kidney function.";
            } else if (primaryArea === 'lifestyle' && riskAreas[primaryArea] > 0) {
                 primaryFocusText = `Optimizing Lifestyle Pillars: ${mostImpactfulLifestyle}. Before diving into diet, improving your foundational habits will accelerate all your results.`;
                 if (sleepValue === 3) microActionText = "Turn off all electronic screens 60 minutes before bedtime tonight to prepare your brain for deep, restorative sleep.";
                 else if (smoking === 3) microActionText = "Set a goal to reduce your daily cigarette count by just one for the rest of the week.";
                 else if (alcohol > 2) microActionText = "Choose two non-drinking days this week and stick to them.";
                 else microActionText = "Find three opportunities today to stand up and walk for 5 minutes (e.g., during a call, after a meal).";
            } else {
                primaryFocusText = "Maintenance and Longevity. Your profile is strong! Focus on maintaining consistent habits and preventing age-related decline.";
                microActionText = "Identify one new fruit or vegetable you've never tried, buy it, and incorporate it into your meal tomorrow for variety and micronutrient diversity.";
            }

            return { primaryFocusText, microActionText };
        }


        // --- MAIN CALCULATION FUNCTION ---

        function calculateRisk(event) {
            event.preventDefault();
            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('calculation-error').classList.add('hidden');

            try {
                // --- 1. Get Mandatory Inputs ---
                const H = getInputValue('height'); 
                const W = getInputValue('weight');  
                const age = getInputValue('age'); 
                const sex = document.getElementById('sex').value;
                const activityValue = getInputValue('activity');
                const smokingValue = getInputValue('smoking');
                const sleepValue = getInputValue('sleep');
                const alcoholValue = getInputValue('alcohol');

                // Basic validation for mandatory fields
                if (!H || !W || !age || sex === "" || activityValue === null || smokingValue === null || sleepValue === null || alcoholValue === null) {
                    document.getElementById('error-message').textContent = 'Please fill in all fields marked with an asterisk (*).';
                    document.getElementById('error-message').classList.remove('hidden');
                    return;
                }

                // --- 2. Initialize Risk Tracking ---
                let totalRiskScore = 0;
                // Track scores by area to determine Primary Focus (Feature A)
                const riskAreas = {
                    metabolic: 0,       // BP, Sugar, Cholesterol
                    anthropometric: 0,  // BMI, WHR
                    lifestyle: 0,       // Smoking, Activity, Sleep, Alcohol
                    specific_labs: 0,   // TSH, Creatinine, Liver Enzymes, Hemoglobin
                    history: 0          // Family History
                };
                const detailedRiskFactors = [];

                // --- 3. Anthropometric Assessment (BMI & WHR) ---
                
                // BMI
                const bmi = calculateBMI(H, W);
                const bmiCategory = getBMICategory(bmi);
                if (bmi < 18.5) {
                    riskAreas.anthropometric += 2; detailedRiskFactors.push('Underweight BMI');
                } else if (bmi >= 25.0 && bmi <= 29.9) {
                    riskAreas.anthropometric += 3; detailedRiskFactors.push('Overweight BMI');
                } else if (bmi >= 30.0) {
                    riskAreas.anthropometric += 5; detailedRiskFactors.push('Obese BMI');
                }

                // WHR (Waist-to-Hip Ratio)
                const waist = getInputValue('waist'); 
                const hip = getInputValue('hip'); 
                let whrCategory = 'Not Provided';
                let whr = null;
                
                if (waist !== null && hip !== null && hip > 0) {
                    whr = waist / hip;
                    const criticalWHR = sex === 'male' ? 0.9 : 0.85; // High risk thresholds
                    if (whr > criticalWHR) {
                        whrCategory = 'High Risk (Abdominal Obesity)'; 
                        riskAreas.anthropometric += 4; // High score for high visceral fat
                        detailedRiskFactors.push('High Visceral Fat (WHR)');
                    } else {
                        whrCategory = 'Normal Range';
                    }
                }
                
                // --- 4. Metabolic & Vitals Assessment ---
                
                const sysBP = getInputValue('sysBP'); 
                const diaBP = getInputValue('diaBP'); 
                const sugar = getInputValue('sugar'); 
                const hba1c = getInputValue('hba1c'); 
                const cholesterol = getInputValue('cholesterol'); 
                
                // BP Risk
                let bpCategory = 'Not Provided';
                if (sysBP !== null && diaBP !== null) { 
                    if ((sysBP >= 130 && sysBP <= 139) || (diaBP >= 80 && diaBP <= 89)) {
                        bpCategory = 'Hypertension Stage 1'; riskAreas.metabolic += 3; detailedRiskFactors.push('Hypertension Stage 1');
                    } else if (sysBP >= 140 || diaBP >= 90) {
                        bpCategory = 'Hypertension Stage 2'; riskAreas.metabolic += 5; detailedRiskFactors.push('Hypertension Stage 2');
                    } else {
                        bpCategory = 'Optimal Range';
                    }
                }

                // Fasting Sugar Risk
                let sugarCategory = 'Not Provided';
                if (sugar !== null) {
                    if (sugar >= 100 && sugar < 126) {
                        sugarCategory = 'Pre-Diabetic'; riskAreas.metabolic += 2; detailedRiskFactors.push('Pre-Diabetic Sugar');
                    } else if (sugar >= 126) {
                        sugarCategory = 'Diabetic Range'; riskAreas.metabolic += 5; detailedRiskFactors.push('Diabetic Sugar Level');
                    } else {
                        sugarCategory = 'Optimal Range';
                    }
                }

                // HbA1c Risk
                let hba1cCategory = 'Not Provided';
                if (hba1c !== null) {
                    if (hba1c >= 5.7 && hba1c < 6.5) {
                        hba1cCategory = 'Pre-Diabetic HbA1c'; riskAreas.metabolic += 3; detailedRiskFactors.push('Pre-Diabetic HbA1c');
                    } else if (hba1c >= 6.5) {
                        hba1cCategory = 'Diabetic Range HbA1c'; riskAreas.metabolic += 5; detailedRiskFactors.push('Diabetic HbA1c Level');
                    } else {
                        hba1cCategory = 'Optimal Range';
                    }
                }

                // Cholesterol Risk
                let cholCategory = 'Not Provided';
                if (cholesterol !== null) {
                    if (cholesterol >= 200 && cholesterol < 240) {
                        cholCategory = 'Borderline High'; riskAreas.metabolic += 1;
                    } else if (cholesterol >= 240) {
                        cholCategory = 'High Cholesterol'; riskAreas.metabolic += 3; detailedRiskFactors.push('High Cholesterol');
                    } else {
                        cholCategory = 'Optimal Range';
                    }
                }
                
                // --- 5. Specific Lab Assessment (Kidney, Thyroid, Liver, Blood) ---
                
                const tsh = getInputValue('tsh');
                const creatinine = getInputValue('creatinine'); 
                const urea = getInputValue('urea');             
                const sgot = getInputValue('sgot');             
                const sgpt = getInputValue('sgpt');             
                const hemoglobin = getInputValue('hemoglobin'); 
                
                // TSH Risk
                let tshCategory = 'Not Provided';
                if (tsh !== null) {
                    if (tsh < 0.4 || tsh > 4.0) {
                        tshCategory = 'Outside Reference Range (Thyroid Risk)'; riskAreas.specific_labs += 3; detailedRiskFactors.push('TSH Outside Range');
                    } else {
                        tshCategory = 'Normal';
                    }
                }
                
                // Creatinine Risk
                let creatCategory = 'Not Provided';
                const creatNormalUpper = sex === 'male' ? 1.2 : 1.1;
                if (creatinine !== null) {
                    if (creatinine > creatNormalUpper) {
                        creatCategory = 'Elevated Creatinine (Kidney Risk)'; riskAreas.specific_labs += 3; detailedRiskFactors.push('Elevated Creatinine');
                    } else {
                        creatCategory = 'Normal';
                    }
                }
                
                // Liver Enzyme Risk
                let sgotCategory = 'Not Provided';
                if (sgot !== null && sgot > 40) {
                    sgotCategory = 'Elevated SGOT/AST (Liver Risk)'; riskAreas.specific_labs += 2; detailedRiskFactors.push('Elevated SGOT/AST');
                } else if (sgot !== null) {
                    sgotCategory = 'Normal';
                }

                let sgptCategory = 'Not Provided';
                if (sgpt !== null && sgpt > 56) {
                    sgptCategory = 'Elevated SGPT/ALT (Liver Risk)'; riskAreas.specific_labs += 2; detailedRiskFactors.push('Elevated SGPT/ALT');
                } else if (sgpt !== null) {
                    sgptCategory = 'Normal';
                }

                // Hemoglobin Risk
                let hbCategory = 'Not Provided';
                const hbNormalLower = sex === 'male' ? 13.5 : 12.0;
                if (hemoglobin !== null) {
                    if (hemoglobin < hbNormalLower) {
                        hbCategory = 'Low Hemoglobin (Anemia Risk)'; riskAreas.specific_labs += 2; detailedRiskFactors.push('Low Hemoglobin (Anemia)');
                    } else {
                        hbCategory = 'Normal';
                    }
                }


                // --- 6. Lifestyle & History Risk (Mandatory & Optional) ---
                
                // Smoking
                if (smokingValue === 3) { riskAreas.lifestyle += 4; detailedRiskFactors.push('Current Smoker'); } 
                else if (smokingValue === 2) { riskAreas.lifestyle += 1; }

                // Activity
                if (activityValue === 1) { riskAreas.lifestyle += 3; detailedRiskFactors.push('Sedentary Lifestyle'); } 
                else if (activityValue === 2) { riskAreas.lifestyle += 1; }
                
                // Sleep (New Feature)
                if (sleepValue === 3) { riskAreas.lifestyle += 3; detailedRiskFactors.push('Chronic Poor Sleep (<6 hours)'); }
                else if (sleepValue === 2) { riskAreas.lifestyle += 1; }
                
                // Alcohol (New Feature)
                if (alcoholValue === 4) { riskAreas.lifestyle += 4; detailedRiskFactors.push('Heavy Alcohol Consumption (Liver Risk)'); }
                else if (alcoholValue === 3) { riskAreas.lifestyle += 2; detailedRiskFactors.push('Moderate Alcohol Consumption'); }

                // Family History (Risk Area: history)
                const familyHistory = Array.from(document.querySelectorAll('input[name="history"]:checked')).map(cb => cb.value);
                if (familyHistory.includes('diabetes')) { riskAreas.history += 2; detailedRiskFactors.push('Family History of Diabetes'); }
                if (familyHistory.includes('heart')) { riskAreas.history += 3; detailedRiskFactors.push('Family History of Heart Disease'); }


                // --- 7. Final Scoring & Categorization ---
                totalRiskScore = Object.values(riskAreas).reduce((sum, score) => sum + score, 0);

                let finalRisk = '';
                let riskColor = '';
                let riskAdvice = '';

                if (totalRiskScore <= 10) {
                    finalRisk = 'Low Risk';
                    riskColor = 'border-green-500 bg-green-50 text-green-800';
                    riskAdvice = 'Excellent work! Your vitals and lifestyle indicators show a strong foundation for health. Focus on maintaining these habits, particularly regular activity and balanced nutrition.';
                } else if (totalRiskScore <= 22) {
                    finalRisk = 'Moderate Risk';
                    riskColor = 'border-amber-500 bg-amber-50 text-amber-800';
                    riskAdvice = 'Caution needed. Your score indicates a few key areas that require attention. These risks are manageable with proactive lifestyle changes and personalized coaching.';
                } else {
                    finalRisk = 'High Risk';
                    riskColor = 'border-red-600 bg-red-50 text-red-800';
                    riskAdvice = 'Urgent attention required. Your score suggests significant risk factors. Immediate, targeted nutrition and lifestyle intervention is strongly recommended to address these concerns.';
                }
                
                // --- 8. Determine Actionable Advice (Primary Focus & Micro-Action) ---
                // We need to pass the sleep value into getActionableAdvice for the micro-action logic to work correctly
                const { primaryFocusText, microActionText } = getActionableAdvice(riskAreas, bmiCategory, smokingValue, activityValue, sleepValue, alcoholValue, sex);
                document.getElementById('primary-focus-text').innerHTML = primaryFocusText;
                document.getElementById('micro-action-text').innerHTML = microActionText;


                // --- 9. Prepare WhatsApp Report Text (for sharing) ---
                const detailedFindings = detailedRiskFactors.length > 0 ? detailedRiskFactors.join(' | ') : 'None/Stable';
                const hba1cValue = hba1c !== null ? hba1c.toFixed(1) : 'N/A';
                const whrValue = whr !== null ? whr.toFixed(2) : 'N/A';

                const reportMessage = 
                    `*HRA Report Summary*%0A---%0A` +
                    `*Risk Level:* ${finalRisk} (Score: ${totalRiskScore})%0A` +
                    `*Primary Focus:* ${primaryFocusText.split('.')[0]}%0A` +
                    `*BMI:* ${bmi.toFixed(1)} (${bmiCategory})%0A` +
                    `*WHR:* ${whrValue} (${whrCategory})%0A` + 
                    `*Key Vitals:* HbA1c ${hba1cValue}% | Sugar ${sugar ?? 'N/A'} | BP ${sysBP ?? 'N/A'}/${diaBP ?? 'N/A'}%0A` +
                    `*Key Issues:* ${detailedFindings}%0A` +
                    `---%0A` +
                    `I saw my results and would like to book my free consultation to discuss my next steps.`;

                const fullContactLink = WHATSAPP_BASE_URL + encodeURIComponent(reportMessage);
                document.getElementById('contact-link').href = fullContactLink;


                // --- 10. Display Results HTML ---
                const creatinineNormalRange = sex === 'male' ? '0.6-1.2' : '0.5-1.1';
                const hemoglobinNormalRange = sex === 'male' ? '13.5-17.5' : '12.0-15.5';

                const riskSummaryHtml = `
                    <h4 class="text-xl font-bold mb-3 ${riskColor.includes('green') ? 'text-green-800' : riskColor.includes('amber') ? 'text-amber-800' : 'text-red-800'}">
                        Total Risk Category: ${finalRisk} <span class="text-sm font-normal"> (Score: ${totalRiskScore})</span>
                    </h4>
                    
                    <p class="lg font-semibold mb-2 border-b pb-2">Body Composition Analysis</p>
                    <ul class="list-disc list-inside text-sm mt-2 space-y-2">
                        ${formatVitalLine('BMI', bmi, '', bmiCategory, '18.5-24.9')}
                        ${formatVitalLine('WHR (Waist/Hip)', whr, '', whrCategory, sex === 'male' ? '<0.90' : '<0.85')}
                    </ul>
                    
                    <p class="lg font-semibold mb-2 mt-4 border-b pb-2">Metabolic & Lab Markers</p>
                    <ul class="list-disc list-inside text-sm mt-2 space-y-2">
                        ${formatVitalLine('Blood Pressure', (sysBP !== null ? sysBP + '/' + diaBP : null), 'mmHg', bpCategory, '<120/<80')}
                        ${formatVitalLine('Fasting Sugar', sugar, 'mg/dL', sugarCategory, '70-99')}
                        ${formatVitalLine('HbA1c', hba1c, '%', hba1cCategory, '<5.7%')}
                        ${formatVitalLine('Total Cholesterol', cholesterol, 'mg/dL', cholCategory, '<200')}
                        ${formatVitalLine('TSH', tsh, '', tshCategory, '0.4-4.0')}
                        ${formatVitalLine('SGPT (ALT)', sgpt, 'U/L', sgptCategory, '7-56')}
                        ${formatVitalLine('Creatinine', creatinine, 'mg/dL', creatCategory, creatinineNormalRange)}
                        ${formatVitalLine('Hemoglobin', hemoglobin, 'g/dL', hbCategory, hemoglobinNormalRange)}
                    </ul>
                    <p class="mt-4 p-3 rounded-lg border ${riskColor.includes('border-green') ? 'border-green-300' : riskColor.includes('border-amber') ? 'border-amber-300' : 'border-red-300'} text-sm italic">${riskAdvice}</p>
                `;
                
                document.getElementById('risk-summary').className = `p-4 rounded-xl shadow-lg border-l-4 ${riskColor}`;
                document.getElementById('risk-summary').innerHTML = riskSummaryHtml;

                // Hiding the form and showing the results section
                document.getElementById('quick-start-cta').classList.add('hidden'); // Hide CTA on results page
                document.getElementById('input-form').classList.add('hidden');
                document.getElementById('result-section').classList.remove('hidden');

                // Trigger MathJax
                typesetResults();
            } catch (error) {
                console.error("Critical calculation error:", error);
                document.getElementById('calculation-error').classList.remove('hidden');
            }
        }

        function resetCalculator() {
            document.getElementById('hra-form').reset();
            // Removed branding-section logic as it was deleted
            document.getElementById('quick-start-cta').classList.remove('hidden'); // Show CTA on reset
            document.getElementById('input-form').classList.remove('hidden');
            document.getElementById('result-section').classList.add('hidden');
            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('calculation-error').classList.add('hidden');
            document.getElementById('live-bmi-feedback').classList.add('hidden');
            document.getElementById('contact-link').href = "#"; 
        }
    </script>

</body>
</html>
